# Docker æœ€ä½³å®è·µç³»åˆ—

-----

## Lightweight Kubernetes development with k3s and Okteto

 è‹±æ–‡åŸæ–‡: <https://medium.com/okteto/lightweight-kubernetes-development-with-k3s-and-okteto-4be08de516a>

A couple of days ago, Rancher labs released k3s, a lightweight, fully compliant production-grade Kubernetes. The entire thing runs out of a 40MB binary, runs on x64 and ARM, and even from a docker-compose. Saying that this is a great engineering feat is an understatement.

I tried it out as soon as I saw the announcement. I expected their initial release to show promise, but to be rough around the edges. Was I in it for a surprise!

I decided to go with the **docker-compose** way so I didnâ€™t have to deal with downloads, configs, and all that. I went ahead, got the compose manifest, and launched it.

``` bash
$ mkdir ~/k3s
$ curl https://raw.githubusercontent.com/rancher/k3s/master/docker-compose.yml > ~/k3s/docker-compose.yml
$ cd ~/k3s
$ docker-compose up -d
Starting k3s_node_1   ... done
Starting k3s_server_1 ... done
```

After about 30 seconds, I had my k3s instance up and running.

``` bash
$ export KUBECONFIG=~/k3s/kubeconfig.yaml
$ kubectl --kubeconfig kubeconfig.yaml get node                                                              (k3s/default)
NAME           STATUS   ROLES    AGE     VERSION
df305e6358a6   Ready    <none>   5m16s   v1.13.3-k3s.6

```

>k3sâ€™ docker-compose drops the kubeconfig file in the same folder you started it at. Great pattern!

We built *[okteto](https://okteto.com/)* to quickly create development environments in your kubernetes cluster. k3s is a fully compliant Kubernetes distro. Will they work together? Only one way to figure it out (full disclosure: Iâ€™m one of Okteto's founders).

For this experiment, I went with the [*movies app sample*](https://github.com/okteto/samples/tree/master/react-kubectl). I cloned the repository and deployed the app with *kubectl*.


k3sçš„docker-composeå°†kubeconfigæ–‡ä»¶æ”¾åœ¨ä½ å¯åŠ¨å®ƒçš„åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚ä¼Ÿå¤§çš„æ¨¡å¼ï¼
æˆ‘ä»¬æ„å»ºäº†oktetoæ¥å¿«é€Ÿåˆ›å»ºkubernetesé›†ç¾¤ä¸­çš„å¼€å‘ç¯å¢ƒã€‚k3sæ˜¯å®Œå…¨å…¼å®¹çš„Kuberneteså‘è¡Œç‰ˆã€‚ä»–ä»¬ä¼šä¸€èµ·å·¥ä½œå—ï¼Ÿåªæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ˆå®Œå…¨æŠ«éœ²ï¼šæˆ‘æ˜¯Oktetoçš„åˆ›å§‹äººä¹‹ä¸€ï¼‰ã€‚

å¯¹äºè¿™ä¸ªå®éªŒï¼Œæˆ‘é€‰æ‹©äº†ç”µå½±åº”ç”¨æ ·æœ¬ã€‚æˆ‘å…‹éš†äº†å­˜å‚¨åº“å¹¶éƒ¨ç½²äº†åº”ç”¨ç¨‹åºkubectlã€‚

``` bash
$ git clone https://github.com/okteto/samples.git
$ cd samples/react-kubectl
$ kubectl apply -f manifests
deployment.extensions/movies created
service/movies created
$ kubectl get pods
NAME                     READY   STATUS    RESTARTS   AGE
movies-7cd9f9ddb-sflwf   1/1     Running   0          55s

```

Once the application is ready, I used okteto to launch my development environment in my k3s instance (install okteto [*from here*](https://okteto.com/docs/getting-started/installation/index.html)).

ä¸€æ—¦åº”ç”¨ç¨‹åºå‡†å¤‡å°±ç»ªï¼Œæˆ‘ä½¿ç”¨oktetoåœ¨æˆ‘çš„k3så®ä¾‹ä¸­å¯åŠ¨æˆ‘çš„å¼€å‘ç¯å¢ƒï¼ˆä»è¿™é‡Œå®‰è£…okteto ï¼‰

``` bash
$ cd movies
$ okteto up
 âœ“  Environment activated!
    Ports:
       9000 -> 9000
       9001 -> 9001
    Cluster:     default
    Deployment:  default/movies

```

After a couple of seconds, my development environment was up and running. I opened a second terminal and used the *okteto run start* command to start the application directly in the development environment:

å‡ ç§’é’Ÿåï¼Œæˆ‘çš„å¼€å‘ç¯å¢ƒå°±å¼€å§‹è¿è¡Œäº†ã€‚æˆ‘æ‰“å¼€äº†ç¬¬äºŒä¸ªç»ˆç«¯å¹¶ä½¿ç”¨è¯¥okteto run startå‘½ä»¤ç›´æ¥åœ¨å¼€å‘ç¯å¢ƒä¸­å¯åŠ¨åº”ç”¨ç¨‹åºï¼š

``` bash
$ export KUBECONFIG=~/k3s/kubeconfig.yaml
$ okteto run start
yarn run v1.6.0
$ CHOKIDAR_USEPOLLING=1 parcel src/index.html --port 9000 --hmr-port 9001
Server running at http://localhost:9000
âœ¨  Built in 8.21s.
```

With the application now running (using [*parcel*](https://github.com/parcel-bundler/parcel)), I fired up my browser and went to <http://localhost:9000> to see the app in all its high-res glory.

ç°åœ¨åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œï¼ˆä½¿ç”¨parcelï¼‰ï¼Œæˆ‘å¯åŠ¨äº†æµè§ˆå™¨å¹¶è½¬åˆ°httpï¼š// localhostï¼š9000ä»¥æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„æ‰€æœ‰é«˜åˆ†è¾¨ç‡è£è€€ã€‚

![movie](https://cdn-images-1.medium.com/max/800/1*J09EldoCmekEWT3wHIru0w.png)

Finally, I went ahead and did some mock dev work to try my entire workflow. I opened vscode, updated the title of the page (*src/App.jsx* line *22*) to Ramiro's Mega Movie Site, saved it and went back to the browser. The changes were automatically reloaded (thanks to parcel's hot reloader) without having to build a container, pick a tag, redeploy it or even refresh my browser! ğŸ˜

æœ€åï¼Œæˆ‘ç»§ç»­åšäº†ä¸€äº›æ¨¡æ‹Ÿå¼€å‘å·¥ä½œæ¥å°è¯•æˆ‘çš„æ•´ä¸ªå·¥ä½œæµç¨‹ã€‚æˆ‘æ‰“å¼€äº†vscodeï¼Œå°†é¡µé¢æ ‡é¢˜ï¼ˆsrc/App.jsxè¡Œ22ï¼‰æ›´æ–°ä¸ºRamiroçš„Mega Movie Siteï¼Œä¿å­˜å¹¶è¿”å›æµè§ˆå™¨ã€‚æ›´æ”¹ä¼šè‡ªåŠ¨é‡æ–°åŠ è½½ï¼ˆæ„Ÿè°¢parcelçš„çƒ­é‡æ–°åŠ è½½å™¨ï¼‰ï¼Œæ— éœ€æ„å»ºå®¹å™¨ï¼Œé€‰æ‹©æ ‡è®°ï¼Œé‡æ–°éƒ¨ç½²ç”šè‡³åˆ·æ–°æµè§ˆå™¨ï¼ğŸ˜


![movie](https://cdn-images-1.medium.com/max/800/1*KFNDQ9ukDkIuIGvbMoeHgg.gif)

### **Conclusion**

k3s is an amazing product. It has some issues (I couldn't get outbound network connections to work). But If this is the first release, I can't wait and see what they come up with in the near future.

Kudos to the team at Rancher for taking the fully compliant approach. With this, their users can leverage the entire ecosystem from day one!

Interested in improving your Kubernetes and Docker development workflows? Contact Okteto and stop waiting for your code to build and redeploy.

k3sæ˜¯ä¸€ä¸ªäº†ä¸èµ·çš„äº§å“ã€‚å®ƒæœ‰ä¸€äº›é—®é¢˜ï¼ˆæˆ‘æ— æ³•ä½¿å‡ºç«™ç½‘ç»œè¿æ¥å·¥ä½œï¼‰ã€‚ä½†å¦‚æœè¿™æ˜¯ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä¸èƒ½ç­‰å¾…ï¼Œçœ‹çœ‹ä»–ä»¬åœ¨ä¸ä¹…çš„å°†æ¥ä¼šå‘ç°ä»€ä¹ˆã€‚

æ„Ÿè°¢Rancherå›¢é˜Ÿé‡‡å–å®Œå…¨åˆè§„çš„æ–¹æ³•ã€‚æœ‰äº†è¿™ä¸ªï¼Œä»–ä»¬çš„ç”¨æˆ·å¯ä»¥ä»ç¬¬ä¸€å¤©å¼€å§‹åˆ©ç”¨æ•´ä¸ªç”Ÿæ€ç³»ç»Ÿï¼

æœ‰å…´è¶£æ”¹è¿›æ‚¨çš„Kuberneteså’ŒDockerå¼€å‘å·¥ä½œæµç¨‹å—ï¼Ÿè”ç³»Oktetoå¹¶åœæ­¢ç­‰å¾…ä»£ç æ„å»ºå’Œé‡æ–°éƒ¨ç½²ã€‚
